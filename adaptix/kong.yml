_format_version: "3.0"
_transform: true

consumers:
  - id: 53a46fb7-0d86-4691-a3ab-6f963182211a
    username: product-client

services:
  - id: 2915b562-3d36-4b29-82ed-c49aaeb45c4b
    name: auth-service
    url: http://auth:8000
    routes:
      # public endpoints (no JWT)
      - id: b3f1c9a2-9e84-4f2c-8e6a-1f2b3c4d5e6f
        name: auth-login-route
        paths:
          - /api/auth/login
          - /api/auth/login/
        strip_path: false
        protocols:
          - http
          - https

      - id: 5543c6e8-07b9-4a0b-96d5-1f92c3d5a415
        name: auth-register-route
        paths:
          - /api/auth/register
          - /api/auth/register/
        strip_path: false
        protocols:
          - http
          - https

      - id: a2d8e9c4-6b11-4f3b-9b8d-2a3c4e5f6b7c
        name: auth-password-reset-route
        paths:
          - /api/auth/password/reset
          - /api/auth/password/reset/
        strip_path: false
        protocols:
          - http
          - https

      - id: c1e7f6b8-5a22-4d88-9c7f-3b4a5c6d7e8f
        name: auth-verify-email-route
        paths:
          - /api/auth/verify-email
          - /api/auth/verify-email/
        strip_path: false
        protocols:
          - http
          - https

      - id: d4f2a1b9-8c33-4e99-8a6b-4c5d6e7f8a90
        name: auth-resend-verification-route
        paths:
          - /api/auth/resend-verification
          - /api/auth/resend-verification/
        strip_path: false
        protocols:
          - http
          - https

      - id: e5a3b2c0-9d44-4faa-9b5c-5d6e7f8a9b01
        name: auth-docs-route
        paths:
          - /api/auth/docs
          - /api/auth/docs/
        strip_path: false
        protocols:
          - http
          - https

      # fallback protected route for all other auth endpoints (requires JWT)
      - id: f6b4c3d2-0e55-4bbb-9c4d-6e7f8a9b0c12
        name: auth-protected-route
        paths:
          - /api/auth
          - /api/auth/
        strip_path: false
        protocols:
          - http
          - https
  - name: company-service
    url: http://company:8000
    routes:
      - name: company-all
        paths:
          - /api/company
        strip_path: false
        protocols:
          - http
          - https

      # docs routes (optional public)
      - name: company-docs-swagger
        paths:
          - /api/company/docs/swagger
          - /api/company/docs/swagger/
        strip_path: false
        protocols:
          - http
          - https

      - name: company-docs-redoc
        paths:
          - /api/company/docs/redoc
          - /api/company/docs/redoc/
        strip_path: false
        protocols:
          - http
          - https

      - name: company-schema
        paths:
          - /api/company/schema
          - /api/company/schema/
        strip_path: false
        protocols:
          - http
          - https

  - name: asset-service
    url: http://adaptix-asset:8000
    routes:
      - name: asset-route
        paths:
          - /api/asset
        strip_path: false
        protocols:
          - http
          - https

  - name: customer-service
    url: http://customer:8000
    routes:
      - name: customer-profile-route
        paths:
          - /api/customer
        strip_path: false
        protocols:
          - http
          - https
      - name: customer-crm-route
        paths:
          - /api/crm
        strip_path: false
        protocols:
          - http
          - https

  - name: product-service
    url: http://product:8000
    routes:
      - name: product-route
        paths:
          - /api/product
        strip_path: false
        protocols:
          - http
          - https

  - name: pos-service
    url: http://pos:8000
    routes:
      - name: pos-route
        paths:
          - /api/pos
        strip_path: false
        protocols:
          - http
          - https

  - name: inventory-service
    url: http://inventory:8000
    routes:
      - name: inventory-route
        paths:
          - /api/inventory
        strip_path: false
        protocols:
          - http
          - https

  - name: purchase-service
    url: http://purchase:8000
    routes:
      - name: purchase-route
        paths:
          - /api/purchase
        strip_path: false
        protocols:
          - http
          - https

  - name: hrms-service
    url: http://hrms:8000
    routes:
      - name: hrms-route
        paths:
          - /api/hrms
        strip_path: false
        protocols:
          - http
          - https

  - name: accounting-service
    url: http://accounting:8000
    routes:
      - name: accounting-route
        paths:
          - /api/accounting
        strip_path: false
        protocols:
          - http
          - https

  - name: notification-service
    url: http://notification:8000
    routes:
      - name: notification-route
        paths:
          - /api/notifications
        strip_path: false
        protocols:
          - http
          - https

  - name: reporting-service
    url: http://reporting:8000
    routes:
      - name: reporting-route
        paths:
          - /api/reporting
        strip_path: false
        protocols:
          - http
          - https

  - name: promotion-service
    url: http://promotion:8000
    routes:
      - name: promotion-route
        paths:
          - /api/promotion
        strip_path: false
        protocols:
          - http
          - https

  - name: payment-service
    url: http://payment:8000
    routes:
      - name: payment-route
        paths:
          - /api/payment
        strip_path: false
        protocols:
          - http
          - https

jwt_secrets:
  - id: 4ba55d53-8acb-403e-a089-edf75b355cc3
    consumer:
      id: 53a46fb7-0d86-4691-a3ab-6f963182211a
    key: auth-service
    algorithm: RS256
    rsa_public_key: |
      -----BEGIN PUBLIC KEY-----
      MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvI0PgQikrEgektcb0Ebv
      Xtv9X2O3hyP5EwzEqNx6y7UkfaofRZL5k8EZ72AsmR+vrkBh6CGwx5emF10d5pGm
      wmZ2dJWrMbUFEYl4Dg32fCy1gXOIXJ/qn+WKrIHueGPHi/CKSzKPStppsgE1du3q
      8BCD5LO9ts+oa8xVo8EKJ2j70E5Z9WHlDeE7PyUttnXdW5JFKMbavxAqLo9v4qp5
      5tvhY9mVQGn/0A8JY2oON0PPz0dQBwGaJ0bpKFnry4sIUsOxBYhF5lbW5Y6LTbl+
      swROaPwd7BezGjHtHW7vK6e/tG3Zsoe+7WXw0U+qJrazSny49/j2Ucu5RREt81hR
      +wIDAQAB
      -----END PUBLIC KEY-----

plugins:
  # CORS applied to the auth service (keeps browser swagger working)
  - name: cors
    service:
      id: 2915b562-3d36-4b29-82ed-c49aaeb45c4b
    config:
      origins: ["*"]
      methods: ["GET", "POST", "OPTIONS", "PUT", "PATCH", "DELETE"]
      headers: ["Authorization", "Content-Type", "Accept"]
      credentials: true

  # JWT plugin applied ONLY to the protected route
  - name: jwt
    route:
      id: f6b4c3d2-0e55-4bbb-9c4d-6e7f8a9b0c12
      protocols:
        - http
        - https
    config:
      claims_to_verify: ["exp"]
      key_claim_name: iss
      uri_param_names: []
      cookie_names: []

consumers:
  - id: 53a46fb7-0d86-4691-a3ab-6f963182211a
    username: auth-service-consumer

