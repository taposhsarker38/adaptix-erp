services:
  postgres:
    image: postgres:15
    container_name: adaptix-postgres
    environment:
      POSTGRES_DB: adaptix
      POSTGRES_USER: ${DB_USER:-adaptix}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-adaptix123}
      RABBITMQ_URL: amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
      SERVICE_NAME: postgres
    ports:
    - 5532:5432
    volumes:
    - postgres_data:/var/lib/postgresql/data
    - ./init-schemas.sql:/docker-entrypoint-initdb.d/init-schemas.sql:ro
    healthcheck:
      test:
      - CMD-SHELL
      - pg_isready -U adaptix -d adaptix
      interval: 20s
      timeout: 10s
      retries: 5
      start_period: 30s
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 1G
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  redis:
    image: redis:7-alpine
    container_name: adaptix-redis
    command: redis-server --appendonly yes --maxmemory 128mb --maxmemory-policy allkeys-lru
    ports:
    - 6679:6379
    volumes:
    - redis_data:/data
    healthcheck:
      test:
      - CMD
      - redis-cli
      - ping
      interval: 20s
      timeout: 10s
      retries: 5
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: adaptix-rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: ${MQ_USER:-adaptix}
      RABBITMQ_DEFAULT_PASS: ${MQ_PASSWORD:-adaptix123}
      RABBITMQ_URL: amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
      SERVICE_NAME: rabbitmq
    ports:
    - 5673:5672
    - 15673:15672
    volumes:
    - rabbitmq_data:/var/lib/rabbitmq
    healthcheck:
      test:
      - CMD
      - rabbitmqctl
      - status
      interval: 30s
      timeout: 10s
      retries: 5
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  kong:
    image: kong:3.0
    container_name: adaptix-kong
    environment:
      KONG_DATABASE: 'off'
      KONG_DECLARATIVE_CONFIG: /kong/kong.yml
      KONG_PROXY_LISTEN: 0.0.0.0:8000
      KONG_ADMIN_LISTEN: 0.0.0.0:8001
      RABBITMQ_URL: amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
      KONG_DNS_RESOLVER: 127.0.0.11
      SERVICE_NAME: kong
    volumes:
    - ./infra/kong/kong.yml:/kong/kong.yml:ro
    - ./keys:/keys:ro
    ports:
    - 8101:8000
    - 8001:8001
    restart: unless-stopped
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 512M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    depends_on:
    - auth-service
  auth-service:
    build:
      context: .
      dockerfile: services/auth/Dockerfile
    container_name: adaptix-auth-service
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=auth
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - REDIS_URL=redis://redis:6379/0
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - PRIVATE_KEY_PATH=/keys/private.pem
    - JWT_ISSUER=auth-service
    - JWT_AUDIENCE=pos-system
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=auth
    - PYTHONPATH=/app:/shared/adaptix_core
    restart: unless-stopped
    ports:
    - 8100:8000
    volumes:
    - ./keys:/keys:ro
    - ./services/auth:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 256M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  company:
    build:
      context: .
      dockerfile: services/company/Dockerfile
    container_name: adaptix-company
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=company
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=company
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/company:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  product:
    build:
      context: .
      dockerfile: services/product/Dockerfile
    container_name: adaptix-product
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=product
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=product
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/product:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  pos:
    build:
      context: .
      dockerfile: services/pos/Dockerfile
    container_name: adaptix-pos
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=pos
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=pos
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/pos:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  inventory-worker:
    build:
      context: .
      dockerfile: services/inventory/Dockerfile
    container_name: adaptix-inventory-worker
    command: python manage.py run_inventory_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=inventory
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=inventory-worker
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./services/inventory:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  inventory:
    build:
      context: .
      dockerfile: services/inventory/Dockerfile
    container_name: adaptix-inventory
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=inventory
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=inventory
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/inventory:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  purchase:
    build:
      context: .
      dockerfile: services/purchase/Dockerfile
    container_name: adaptix-purchase
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=purchase
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=purchase
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/purchase:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  purchase-worker:
    build:
      context: .
      dockerfile: services/purchase/Dockerfile
    container_name: adaptix-purchase-worker
    command: python manage.py run_purchase_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=purchase
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=purchase-worker
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./services/purchase:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  hrms-service:
    build:
      context: .
      dockerfile: services/hrms/Dockerfile
    container_name: adaptix-hrms-service
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=hrms
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=hrms
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/hrms:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  accounting:
    build:
      context: .
      dockerfile: services/accounting/Dockerfile
    container_name: adaptix-accounting
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=accounting
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=accounting
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/accounting:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  accounting-worker:
    build:
      context: .
      dockerfile: services/accounting/Dockerfile
    container_name: adaptix-accounting-worker
    command: python manage.py run_accounting_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=accounting
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=accounting-worker
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./services/accounting:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  customer:
    build:
      context: .
      dockerfile: services/customer/Dockerfile
    container_name: adaptix-customer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=customer
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=customer
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/customer:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  customer-worker:
    build:
      context: .
      dockerfile: services/customer/Dockerfile
    container_name: adaptix-customer-worker
    command: python manage.py run_loyalty_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=customer
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=customer-worker
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/customer:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  asset:
    build:
      context: .
      dockerfile: services/asset/Dockerfile
    container_name: adaptix-asset
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=asset
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=asset
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/asset:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  promotion:
    build:
      context: .
      dockerfile: services/promotion/Dockerfile
    container_name: adaptix-promotion
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=promotion
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=promotion
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/promotion:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  payment:
    build:
      context: .
      dockerfile: services/payment/Dockerfile
    container_name: adaptix-payment
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=payment
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=payment
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/payment:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  notification:
    build:
      context: .
      dockerfile: services/notification/Dockerfile
    container_name: adaptix-notification
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=notification
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=notification
    - PYTHONPATH=/app:/shared/adaptix_core
    - DEFAULT_FROM_EMAIL=MyApp <info@expotechglobal.com>
    - EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
    - EMAIL_HOST=sg2plzcpnl476824.prod.sin2.secureserver.net
    - EMAIL_PORT=465
    - EMAIL_HOST_USER=info@expotechglobal.com
    - EMAIL_HOST_PASSWORD='Ca[_TcR^!O$$]'
    - EMAIL_USE_TLS=False
    - EMAIL_USE_SSL=True
    volumes:
    - ./keys:/keys:ro
    - ./services/notification:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  notification-worker:
    build:
      context: .
      dockerfile: services/notification/Dockerfile
    container_name: adaptix-notification-worker
    command: python manage.py run_notification_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=notification
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=notification-worker
    - PYTHONPATH=/app:/shared/adaptix_core
    - DEFAULT_FROM_EMAIL=MyApp <info@expotechglobal.com>
    - EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
    - EMAIL_HOST=sg2plzcpnl476824.prod.sin2.secureserver.net
    - EMAIL_PORT=465
    - EMAIL_HOST_USER=info@expotechglobal.com
    - EMAIL_HOST_PASSWORD='Ca[_TcR^!O$$]'
    - EMAIL_USE_TLS=False
    - EMAIL_USE_SSL=True
    volumes:
    - ./services/notification:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  reporting:
    build:
      context: .
      dockerfile: services/reporting/Dockerfile
    container_name: adaptix-reporting
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=reporting
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - CELERY_BROKER_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=reporting
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/reporting:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 512M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  reporting-worker:
    build:
      context: .
      dockerfile: services/reporting/Dockerfile
    container_name: adaptix-reporting-worker
    command: python manage.py run_reporting_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=reporting
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - CELERY_BROKER_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=reporting-worker
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/reporting:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      reporting:
        condition: service_started
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  ai-service:
    build:
      context: .
      dockerfile: services/intelligence/Dockerfile
    container_name: adaptix-ai-service
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=intelligence
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - REDIS_URL=redis://redis:6379/0
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=ai
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/intelligence:/app
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 512M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  ws-gateway:
    build:
      context: .
      dockerfile: services/ws-gateway/Dockerfile
    container_name: adaptix-ws-gateway
    environment:
    - PORT=9001
    - AMQP_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - AMQP_EXCHANGE=events
    - REDIS_URL=redis://redis:6379/0
    - PUBLIC_KEY_PATH=/keys/public.pem
    - AUTH_ISSUER=auth-service
    - ALLOW_ORIGIN=*
    - SERVICE_NAME=ws-gateway
    volumes:
    - ./keys:/keys:ro
    - ./services/ws-gateway:/app
    - /app/node_modules
    depends_on:
    - rabbitmq
    - redis
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  frontend-app:
    build: ./frontend
    container_name: adaptix-frontend-app
    environment:
    - NEXT_PUBLIC_API_URL=http://localhost:8101/api
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=frontend-app
    - NODE_OPTIONS=--max-old-space-size=2560
    ports:
    - 3000:3000
    restart: unless-stopped
    volumes:
    - ./frontend:/app
    - /app/node_modules
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 3G
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    depends_on:
    - kong
  quality-service:
    build:
      context: .
      dockerfile: services/quality/Dockerfile
    container_name: adaptix-quality-service
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=quality_schema
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - JWT_AUDIENCE=pos-system
    - JWT_ISSUER=auth-service
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=quality
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./services/quality:/app
    - ./keys:/keys:ro
    - ./shared:/shared
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 5s
      retries: 5
    command: python manage.py runserver 0.0.0.0:8000
  logistics-service:
    build:
      context: .
      dockerfile: services/logistics/Dockerfile
    container_name: adaptix-logistics
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=logistics
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=logistics
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./services/logistics:/app
    - ./keys:/keys:ro
    - ./shared:/shared
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    depends_on:
      postgres:
        condition: service_healthy
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 5s
      retries: 5
    command: python manage.py runserver 0.0.0.0:8000
  audit-consumer:
    build:
      context: .
      dockerfile: services/auth/Dockerfile
    container_name: adaptix-audit-consumer
    command: python manage.py consume_audit_logs
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=auth
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=audit-consumer
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./services/auth:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  ai-worker:
    build:
      context: .
      dockerfile: services/intelligence/Dockerfile
    container_name: adaptix-ai-worker
    command: celery -A config.celery_app worker --loglevel=info
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=intelligence
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - CELERY_BROKER_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - REDIS_URL=redis://redis:6379/0
    - SERVICE_NAME=ai-worker
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./services/intelligence:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  manufacturing-worker:
    build:
      context: .
      dockerfile: services/manufacturing/Dockerfile
    container_name: adaptix-manufacturing-worker
    command: python manage.py run_mrp_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=manufacturing
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=manufacturing-worker
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./services/manufacturing:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
  manufacturing:
    build:
      context: .
      dockerfile: services/manufacturing/Dockerfile
    container_name: adaptix-manufacturing
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=manufacturing
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - ENABLE_TRACING=False
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=manufacturing
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./keys:/keys:ro
    - ./services/manufacturing:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 192M
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: '3'
    command: python manage.py runserver 0.0.0.0:8000
  quality-worker:
    build:
      context: .
      dockerfile: services/quality/Dockerfile
    container_name: adaptix-quality-worker
    command: python manage.py run_quality_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=quality
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=quality-worker
    - PYTHONPATH=/app:/shared/adaptix_core
    volumes:
    - ./services/quality:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
volumes:
  postgres_data: null
  redis_data: null
  rabbitmq_data: null
networks:
  backend:
    driver: bridge
