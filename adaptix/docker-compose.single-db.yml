services:
  postgres:
    image: postgres:15
    container_name: adaptix-postgres
    environment:
      POSTGRES_DB: adaptix
      POSTGRES_USER: ${DB_USER:-adaptix}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-adaptix123}
      RABBITMQ_URL: amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
      SERVICE_NAME: postgres
    ports:
    - 5532:5432
    volumes:
    - postgres_data:/var/lib/postgresql/data
    - ./init-schemas.sql:/docker-entrypoint-initdb.d/init-schemas.sql:ro
    healthcheck:
      test:
      - CMD-SHELL
      - pg_isready -U adaptix -d adaptix
      interval: 5s
      timeout: 5s
      retries: 20
      start_period: 10s
    networks:
    - backend
    deploy:
      resources:
        limits:
          memory: 4G
  redis:
    image: redis:7-alpine
    container_name: adaptix-redis
    command: redis-server --appendonly yes --maxmemory 256mb --maxmemory-policy allkeys-lru
    ports:
    - 6679:6379
    volumes:
    - redis_data:/data
    healthcheck:
      test:
      - CMD
      - redis-cli
      - ping
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
    - backend
  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: adaptix-rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: ${MQ_USER:-adaptix}
      RABBITMQ_DEFAULT_PASS: ${MQ_PASSWORD:-adaptix123}
      RABBITMQ_URL: amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
      SERVICE_NAME: rabbitmq
    ports:
    - 5673:5672
    - 15673:15672
    volumes:
    - rabbitmq_data:/var/lib/rabbitmq
    healthcheck:
      test:
      - CMD
      - rabbitmqctl
      - status
      interval: 10s
      timeout: 10s
      retries: 5
    networks:
    - backend
  kong:
    image: kong:3.0
    container_name: adaptix-kong
    environment:
      KONG_DATABASE: 'off'
      KONG_DECLARATIVE_CONFIG: /kong/kong.yml
      KONG_PROXY_LISTEN: 0.0.0.0:8000
      KONG_ADMIN_LISTEN: 0.0.0.0:8001
      RABBITMQ_URL: amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
      SERVICE_NAME: kong
    volumes:
    - ./infra/kong/kong.yml:/kong/kong.yml:ro
    - ./keys:/keys:ro
    ports:
    - 8101:8000
    - 8001:8001
    networks:
    - backend
    depends_on:
    - auth-service
  auth-service:
    build:
      context: .
      dockerfile: services/auth/Dockerfile
    container_name: adaptix-auth-service
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=auth
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - REDIS_URL=redis://redis:6379/0
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - PRIVATE_KEY_PATH=/keys/private.pem
    - JWT_ISSUER=auth-service
    - JWT_AUDIENCE=pos-system
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=auth
    ports:
    - 8100:8000
    volumes:
    - ./keys:/keys:ro
    - ./services/auth:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
    - backend
  company:
    build:
      context: .
      dockerfile: services/company/Dockerfile
    container_name: adaptix-company
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=company
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=company
    volumes:
    - ./keys:/keys:ro
    - ./services/company:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
  product:
    build:
      context: .
      dockerfile: services/product/Dockerfile
    container_name: adaptix-product
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=product
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=product
    volumes:
    - ./keys:/keys:ro
    - ./services/product:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
  pos:
    build:
      context: .
      dockerfile: services/pos/Dockerfile
    container_name: adaptix-pos
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=pos
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=pos
    volumes:
    - ./keys:/keys:ro
    - ./services/pos:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
  inventory-worker:
    build:
      context: .
      dockerfile: services/inventory/Dockerfile
    container_name: adaptix-inventory-worker
    command: python manage.py run_inventory_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=inventory
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=inventory-worker
    volumes:
    - ./services/inventory:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
  inventory:
    build:
      context: .
      dockerfile: services/inventory/Dockerfile
    container_name: adaptix-inventory
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=inventory
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=inventory
    volumes:
    - ./keys:/keys:ro
    - ./services/inventory:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
  purchase:
    build:
      context: .
      dockerfile: services/purchase/Dockerfile
    container_name: adaptix-purchase
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=purchase
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=purchase
    volumes:
    - ./keys:/keys:ro
    - ./services/purchase:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
  hrms-service:
    build:
      context: .
      dockerfile: services/hrms/Dockerfile
    container_name: adaptix-hrms-service
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=hrms
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=hrms
    volumes:
    - ./keys:/keys:ro
    - ./services/hrms:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
  accounting:
    build:
      context: .
      dockerfile: services/accounting/Dockerfile
    container_name: adaptix-accounting
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=accounting
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=accounting
    volumes:
    - ./keys:/keys:ro
    - ./services/accounting:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
  customer:
    build:
      context: .
      dockerfile: services/customer/Dockerfile
    container_name: adaptix-customer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=customer
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=customer
    volumes:
    - ./keys:/keys:ro
    - ./services/customer:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
  customer-worker:
    build:
      context: .
      dockerfile: services/customer/Dockerfile
    container_name: adaptix-customer-worker
    command: python manage.py run_loyalty_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=customer
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=customer-worker
    volumes:
    - ./keys:/keys:ro
    - ./services/customer:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
  asset:
    build:
      context: .
      dockerfile: services/asset/Dockerfile
    container_name: adaptix-asset
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=asset
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=asset
    volumes:
    - ./keys:/keys:ro
    - ./services/asset:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
  promotion:
    build:
      context: .
      dockerfile: services/promotion/Dockerfile
    container_name: adaptix-promotion
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=promotion
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=promotion
    volumes:
    - ./keys:/keys:ro
    - ./services/promotion:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
  payment:
    build:
      context: .
      dockerfile: services/payment/Dockerfile
    container_name: adaptix-payment
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=payment
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=payment
    volumes:
    - ./keys:/keys:ro
    - ./services/payment:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
    networks:
    - backend
  notification:
    build:
      context: .
      dockerfile: services/notification/Dockerfile
    container_name: adaptix-notification
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=notification
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=notification
    volumes:
    - ./keys:/keys:ro
    - ./services/notification:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
  reporting:
    build:
      context: .
      dockerfile: services/reporting/Dockerfile
    container_name: adaptix-reporting
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=reporting
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - CELERY_BROKER_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=reporting
    volumes:
    - ./keys:/keys:ro
    - ./services/reporting:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
  reporting-worker:
    build:
      context: .
      dockerfile: services/reporting/Dockerfile
    container_name: adaptix-reporting-worker
    command: python manage.py run_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=reporting
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - CELERY_BROKER_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=reporting-worker
    volumes:
    - ./keys:/keys:ro
    - ./services/reporting:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      reporting:
        condition: service_started
    networks:
    - backend
  ai-service:
    build:
      context: .
      dockerfile: services/intelligence/Dockerfile
    container_name: adaptix-ai-service
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=intelligence
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - REDIS_URL=redis://redis:6379/0
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=ai
    volumes:
    - ./keys:/keys:ro
    - ./services/intelligence:/app
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
  frontend-app:
    build: ./frontend
    container_name: adaptix-frontend-app
    environment:
    - NEXT_PUBLIC_API_URL=http://localhost:8101/api
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=frontend-app
    ports:
    - 3000:3000
    volumes:
    - ./frontend:/app
    - /app/node_modules
    networks:
    - backend
    depends_on:
    - kong
  quality-service:
    build:
      context: .
      dockerfile: services/quality/Dockerfile
    container_name: adaptix-quality-service
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=quality_schema
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - JWT_AUDIENCE=pos-system
    - JWT_ISSUER=auth-service
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=quality
    volumes:
    - ./services/quality:/app
    - ./keys:/keys:ro
    - ./shared:/shared
    networks:
    - backend
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 10s
      timeout: 5s
      retries: 5
  logistics-service:
    build:
      context: .
      dockerfile: services/logistics/Dockerfile
    container_name: adaptix-logistics
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=logistics
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=logistics
    volumes:
    - ./services/logistics:/app
    - ./keys:/keys:ro
    - ./shared:/shared
    networks:
    - backend
    depends_on:
      postgres:
        condition: service_healthy
    healthcheck:
      test:
      - CMD-SHELL
      - python3 -c 'import urllib.request; urllib.request.urlopen("http://127.0.0.1:8000/health/")'
      interval: 10s
      timeout: 5s
      retries: 5
  audit-consumer:
    build:
      context: .
      dockerfile: services/auth/Dockerfile
    container_name: adaptix-audit-consumer
    command: python manage.py consume_audit_logs
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=auth
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=audit-consumer
    volumes:
    - ./services/auth:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
  ai-worker:
    build:
      context: .
      dockerfile: services/intelligence/Dockerfile
    container_name: adaptix-ai-worker
    command: celery -A config.celery_app worker --loglevel=info
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=intelligence
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - CELERY_BROKER_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - REDIS_URL=redis://redis:6379/0
    - SERVICE_NAME=ai-worker
    volumes:
    - ./services/intelligence:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
  manufacturing-worker:
    build:
      context: .
      dockerfile: services/manufacturing/Dockerfile
    container_name: adaptix-manufacturing-worker
    command: python manage.py run_mrp_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=manufacturing
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=manufacturing-worker
    volumes:
    - ./services/manufacturing:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
  manufacturing:
    build:
      context: .
      dockerfile: services/manufacturing/Dockerfile
    container_name: adaptix-manufacturing
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=manufacturing
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - DEBUG=True
    - PUBLIC_KEY_PATH=/keys/public.pem
    - JWT_ALGORITHM=RS256
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=manufacturing
    volumes:
    - ./keys:/keys:ro
    - ./services/manufacturing:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
  quality-worker:
    build:
      context: .
      dockerfile: services/quality/Dockerfile
    container_name: adaptix-quality-worker
    command: python manage.py run_quality_consumer
    environment:
    - DATABASE_URL=postgres://${DB_USER:-adaptix}:${DB_PASSWORD:-adaptix123}@postgres:5432/adaptix
    - DB_SCHEMA=quality
    - SECRET_KEY=${SECRET_KEY:-your-secret-key}
    - RABBITMQ_URL=amqp://${MQ_USER:-adaptix}:${MQ_PASSWORD:-adaptix123}@rabbitmq:5672/
    - SERVICE_NAME=quality-worker
    volumes:
    - ./services/quality:/app
    - ./shared:/shared
    depends_on:
      postgres:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
    - backend
volumes:
  postgres_data: null
  redis_data: null
  rabbitmq_data: null
networks:
  backend:
    driver: bridge
